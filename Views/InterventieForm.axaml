<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="https://github.com/avaloniaui/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             x:Class="Elumatec.Tijdregistratie.Views.InterventieForm"
             mc:Ignorable="d"
             d:DesignWidth="1000"
             d:DesignHeight="600">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top row: messages (center) + timer + username (right) -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Warning/Status Messages at Center -->
            <StackPanel Grid.Column="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                
                <!-- Warning message -->
                <Border Background="#FFEBEE"
                        BorderBrush="#F44336"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <TextBlock Text="{Binding StatusMessage}"
                               Foreground="#C62828"
                               TextWrapping="Wrap"
                               MaxWidth="400"
                               TextAlignment="Center"/>
                </Border>

                <!-- PDF downloaded message -->
                <Border Background="#E8F5E9"
                        BorderBrush="#4CAF50"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        IsVisible="{Binding PdfDownloaded}">
                    <TextBlock Text="PDF gedownload"
                               Foreground="#2E7D32"
                               TextAlignment="Center"/>
                </Border>
            </StackPanel>

            <!-- Timer + username (right) -->
            <StackPanel Grid.Column="1"
                        Orientation="Vertical"
                        HorizontalAlignment="Right">
                <TextBlock Text="{Binding TimerDisplay}"
                           FontSize="24"
                           FontWeight="Bold"
                           HorizontalAlignment="Right"/>
                <TextBlock Text="{Binding Username}"
                           FontSize="14"
                           Opacity="0.7"
                           HorizontalAlignment="Right"/>
            </StackPanel>
        </Grid>

        <!-- Main content -->
        <Grid Grid.Row="1"
              ColumnDefinitions="3*,5*"
              ColumnSpacing="20">

            <!-- LEFT -->
            <StackPanel Grid.Column="0" Spacing="10">

                <StackPanel>
                    <TextBlock Text="Bedrijf" FontWeight="SemiBold"/>
    
                    <!-- AutoCompleteBox for searching bedrijven (only for new interventies) -->
                    <AutoCompleteBox 
                        ItemsSource="{Binding BedrijvenSuggestions}"
                        SelectedItem="{Binding SelectedBedrijf}"
                        FilterMode="Contains"
                        Watermark="Zoek bedrijf..."
                        IsVisible="{Binding !IsPrefilled}"
                        MinimumPrefixLength="1"
                        ValueMemberBinding="{Binding BedrijfNaam}">
                        <AutoCompleteBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding BedrijfNaam}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Stad}" FontSize="11" Opacity="0.6"/>
                                </StackPanel>
                            </DataTemplate>
                        </AutoCompleteBox.ItemTemplate>
                    </AutoCompleteBox>
                    
                    <!-- Show selected bedrijf name when prefilled (read-only for existing interventies) -->
                    <TextBlock Text="{Binding Bedrijfsnaam}"
                               IsVisible="{Binding IsPrefilled}"
                               Padding="8"
                               Background="#F5F5F5"
                               FontSize="14"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Machine" FontWeight="SemiBold"/>
                    
                    <!-- TextBox for new interventies -->
                    <TextBox Text="{Binding Machine}"
                             IsVisible="{Binding !IsPrefilled}"/>
                    
                    <!-- Read-only display for existing interventies -->
                    <TextBlock Text="{Binding Machine}"
                               IsVisible="{Binding IsPrefilled}"
                               Padding="8"
                               Background="#F5F5F5"
                               FontSize="14"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Contactpersoon Naam" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ContactpersoonNaam}"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Contactpersoon Email" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ContactpersoonEmail}"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Contactpersoon Telefoon" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ContactpersoonTelefoon}"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Totale looptijd" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TotalTimeDisplay}"
                            FontSize="16"
                            Padding="8"
                            Background="#F5F5F5"/>
                </StackPanel>

            </StackPanel>

            <!-- RIGHT -->
            <StackPanel Grid.Column="1" Spacing="20">

                <StackPanel>
                    <TextBlock Text="Interne notities" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding InterneNotities}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="200"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Externe notities" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ExterneNotities}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="200"/>
                </StackPanel>

            </StackPanel>

        </Grid>

        <!-- Bottom right buttons -->
        <StackPanel Grid.Row="2"
                    HorizontalAlignment="Right"
                    Spacing="8">

            <!-- Buttons row -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Spacing="10"
                        VerticalAlignment="Bottom">

                <Button Content="Tijdelijk stoppen"
                        Command="{Binding StopAndSaveCommand}"/>

                <Button Content="Afronden &amp; PDF maken"
                        Command="{Binding DownloadPdfCommand}"/>

            </StackPanel>

        </StackPanel>
    </Grid>
</UserControl>